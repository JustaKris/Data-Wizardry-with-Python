# Using uv for Package Management

**uv** is our recommended Python package manager. It's a modern, extremely fast tool written in Rust that handles dependency management and virtual environments seamlessly.

## Why uv?

- **Speed**: 10-100x faster than pip
- **Simplicity**: Modern workflow with `uv sync`
- **Reliability**: Better dependency resolution with lock files
- **Reproducibility**: Guaranteed identical environments across team

## Installing uv

### Recommended: Install with pip

The simplest and most reliable method:

```bash
pip install uv
```

Verify installation:

```bash
uv --version
```

### Alternative: Standalone Installer

**Windows (PowerShell):**

```powershell
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

**macOS/Linux:**

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

## Setting Up Your Project

### 1. Clone the Repository

First, get the project code:

```bash
git clone https://gitlab.td.gfk.com/mm/pet/analysis/data-wizardry-with-python.git
cd data-wizardry-with-python
```

### 2. Sync Dependencies (Recommended Workflow)

The modern approach using `uv sync`:

```bash
# Create venv and install all dependencies from pyproject.toml
uv sync

# Or sync with specific groups
uv sync --group dev
uv sync --group docs
uv sync --all-groups  # Install everything
```

This command:

- Creates a `.venv` folder automatically if it doesn't exist
- Installs all dependencies from `pyproject.toml`
- Generates/updates `uv.lock` for reproducibility
- Ensures everyone has identical package versions

### 3. Activate the Environment

**Windows (PowerShell):**

```powershell
.venv\Scripts\activate
```

**macOS/Linux:**

```bash
source .venv/bin/activate
```

You'll see `(.venv)` in your terminal prompt when activated.

## Understanding the Workflow

### pyproject.toml - The Source of Truth

All dependencies are defined in `pyproject.toml`:

```toml
[project]
dependencies = [
    "pandas>=2.0.0",
    "numpy>=1.24.0",
    # ... more packages
]

[dependency-groups]
dev = ["pytest>=8.3.0", "black>=24.0.0", ...]
docs = ["mkdocs>=1.5.0", ...]
ds = ["scikit-learn>=1.3.0", ...]
```

### uv.lock - Reproducibility

When you run `uv sync`, uv creates/updates `uv.lock` with exact versions:

```bash
# Everyone on the team runs this
uv sync

# Result: Identical package versions for everyone
```

**Commit both files to Git**:

- `pyproject.toml` - What you want
- `uv.lock` - Exact versions that work

## Daily Workflow

### With Activated Environment

Once you've activated the environment (as shown above), you can run commands normally:

```bash
# Run Python scripts
python script.py

# Start Jupyter
jupyter lab

# Install new packages with uv add
uv add package-name
```

### Without Activating (uv run)

uv can run commands without activating the environment:

```bash
# Run Python
uv run python script.py

# Start Jupyter
uv run jupyter lab

# Run any command in the virtual environment
uv run <command>
```

## Common Commands

### Working with Packages

```bash
# Sync to latest from pyproject.toml
uv sync

# Add a new package
uv add pandas matplotlib

# Add a development dependency
uv add --group dev pytest

# Remove a package
uv remove package-name

# Update all packages
uv sync --upgrade

# Run a command without activating
uv run python script.py
uv run jupyter lab
```

### Managing Dependency Groups

```bash
# Sync only core dependencies
uv sync

# Add dev tools
uv sync --group dev

# Add docs tools
uv sync --group docs

# Add everything
uv sync --all-groups
```

### Python Version Management

```bash
# Install Python 3.11
uv python install 3.11

# Install Python 3.12
uv python install 3.12

# List installed versions
uv python list

# Create venv with specific Python
uv venv --python 3.11
```

## Alternative: Using uv pip (Less Common)

You can still use `uv pip` for traditional workflows:

```bash
# Install from requirements file
uv pip install -r requirements.txt

# Install specific package
uv pip install pandas

# List installed packages
uv pip list

# Freeze environment
uv pip freeze > requirements.txt
```

**Note**: `uv sync` is preferred as it ensures reproducibility through lock files.

## Resetting Your Environment

Sometimes you need a fresh start:

### Quick Reset

```bash
# Remove and recreate environment
Remove-Item -Recurse -Force .venv  # Windows
rm -rf .venv  # macOS/Linux

# Sync from scratch
uv sync --all-groups
```

### Clean Cache

```bash
# Clear uv's cache (troubleshooting)
uv cache clean
```

## Troubleshooting

### "uv: command not found"

After `pip install uv`, restart your terminal or run:

**Windows:**

```powershell
refreshenv  # if you have Chocolatey
# Or restart terminal
```

**macOS/Linux:**

```bash
source ~/.bashrc  # or ~/.zshrc
```

### Sync Fails

```bash
# Update uv
pip install --upgrade uv

# Clear cache and retry
uv cache clean
uv sync --all-groups
```

### Missing Dependencies

```bash
# Ensure lock file is current
uv lock

# Then sync
uv sync --all-groups
```

## Best Practices

1. **Use `uv sync` as default**: Most reliable and reproducible
2. **Commit `pyproject.toml` and `uv.lock`**: Ensures team consistency
3. **Run `uv sync` after pulling**: Get latest dependencies
4. **Use `uv add` to add packages**: Automatically updates pyproject.toml
5. **Specify Python version**: Use `uv venv --python 3.11` for team consistency
6. **Use dependency groups**: Organize optional dependencies (dev, docs, ds)

### Recommended Team Workflow

```bash
# Initial setup
git clone <repo>
cd Data-Wizardry-with-Python
uv sync --all-groups

# Daily work
uv run jupyter lab  # No activation needed

# Adding a dependency
uv add new-package
git add pyproject.toml uv.lock
git commit -m "Add new-package"

# After pulling changes
uv sync
```

## Example: Complete Setup

```bash
# 1. Clone repository
git clone https://gitlab.com/your-org/Data-Wizardry-with-Python.git
cd Data-Wizardry-with-Python

# 2. Sync dependencies
uv sync --all-groups

# 3. Verify setup
uv run python -c "import pandas; print(f'pandas {pandas.__version__}')"

# 4. Start working
uv run jupyter lab
```

## Next Steps

Now that uv is configured:

1. **Configure VS Code**: Continue to [Running Notebooks](04-notebooks.md)
2. **Start learning**: Try the [Quick Start Guide](05-quickstart.md)
3. **Open a notebook**: Navigate to `notebooks/01_into_and_data_loading.ipynb`
